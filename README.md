# NestJS/TypeORM/GraphQL/PostgresQL

NestJS boilerplate with TypeORM, GraphQL and PostgreslQL

## Open for Contribution

Totally open for any Pull Request, please feel free to contribute in any ways.
There can be errors related with type or something. It would be very helpful to me for you to fix this errors.

## [NestJS](https://docs.nestjs.com/)

Base NestJS, We like it

## [TypeORM](https://typeorm.io/)

We use [Nestjs/TypeORM](https://docs.nestjs.com/techniques/database)
In this template, We've been trying not to use `Pure SQL` to make the most of TypeORM.

## [PostgresQL Database](https://www.postgresql.org/)

We use postgresQL for backend database, The default database taht will be used is named 'postgres'
You have to have postgresql Database server before getting started.
You can use [Docker postgresQL](https://hub.docker.com/_/postgres) to have server easily

## [GraphQL](https://graphql.org/)

##### packages: graphql, apollo-server-express and @nestjs/graphql, [graphqlUpload](https://www.npmjs.com/package/graphql-upload) ...

We use GraphQL in a Code First approach (our code will create the GraphQL Schemas).

We don't use [swagger](https://docs.nestjs.com/openapi/introduction) now, but you can use this if you want to.
You can see [playground](http://localhost:8000/graphql)

We use apollographql as playground. but if you want to use default playground, you can do like below.

```js
// app.modules.js

GraphQLModule.forRootAsync <
  ApolloDriverConfig >
  {
    ...
    useFactory: (configService: ConfigService) => ({
      ...
      playground: true,
      ...
    }),
    ...
  };
```

### Protected queries/mutation by user role with guard

Some of the GraphQL queries are protected by a NestJS Guard (`GraphqlPassportAuthGuard`) and requires you to be authenticated (and some also requires to have the Admin role).
You can solve them with Sending JWT token in `Http Header` with the `Authorization`.

```json
# Http Header
{
  "Authorization": "Bearer TOKEN"
}
```

#### Example of some protected GraphQL

- getMe (must be authenticated)
- All the other generated by generator (must be authenticated and must be admin)

## License

MIT

## Custom CRUD

To make most of GraphQL's advantage, We created its own api, such as GetMany or GetOne.
We tried to make it as comfortable as possible, but if you find any mistakes or improvements, please point them out or promote them.

You can see detail in `declare.module.ts`, `processWhere.ts` and `custom.input.ts`

```js
// query
query($input:GetManyInput) {
  getManyPlaces(input:$input){
    data{
      id
      logitude
      count
    }
  }
}
```

```js
// variables
{
  input: {
    pagination: {
      size: 10,
      page: 0, // Started from 0
    },
    order: { id: 'DESC' },
    relations: ['place'],
    dataType: 'data', //all or count or data - default: all
    where: {
      id: 3,
    },
  },
};
```

You can see detail of operators in where below or in code.
![image](https://bewave.s3.ap-northeast-2.amazonaws.com/temp/%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA+2022-12-02+%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE+8.18.40.png)

## Code generator

There is [CRUD Generator in NestJS](https://docs.nestjs.com/recipes/crud-generator).
In this repository, It has its own generator.
You can use like below.

```bash
$ yarn g
```

## Getting Started

### Installation

Before you start, make sure you have a recent version of [NodeJS](http://nodejs.org/) environment _>=14.0_ with NPM 6 or Yarn.

The first thing you will need is to install NestJS CLI.

```bash
$ yarn -g @nestjs/cli
```

And do install the dependencies

```bash
$ yarn install # or npm install
```

### Run

for development

```bash
$ yarn dev # or npm run dev
```

or run with docker

```bash
$ docker-compose --env-file ./.development.env up --build
```

for production

```bash
$ yarn build # or npm run build
$ yarn start # or npm run start
```

## Docker

### Docker-compose installation

Download docker from [Official website](https://docs.docker.com/compose/install)

### Run

Open terminal and navigate to project directory and run the following command.

```bash
# Only for development
$ yarn start:docker
```

### After installing new dependency

If you installed new dependency, you need to restart docker to recreate docker image.

```bash
$ yarn start:docker
```

### Note

If you want to use docker, you have to set DB_HOST in .development.env to be `postgres`.
The default set is `postgres`

## Todo

- [ ] Strict typescript
- [ ] Get Jest(e2e or unit test) to be work
- [ ] Add Many OAUths (Both of front and back end)

  - [ ] Kakao
  - [ ] Google
  - [ ] Apple
  - [ ] Naver

- [ ] Healthcheck
- [x] Divide usefactory
